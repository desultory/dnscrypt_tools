#!/sbin/nft -f

define dnscrypt_v4_clients = { 10.53.53.2 }

table inet filter {
  set dnscrypt_ports {
    type inet_service
    elements = { 5443, 9443, 453, 2053, 2054, 1443, 5353, 50443, 8443, 4443, 4434, 54, 4343, 15353, 443, 5053 }
  }
  set dnscrypt_sources_ipv4 {
    type ipv4_addr
    elements = { 23.19.245.88, 133.130.113.163, 16.170.150.221, 37.120.193.219, 199.180.130.39, 139.99.222.72, 172.67.173.59, 207.246.87.96, 1.12.12.12, 162.19.129.20, 149.112.112.112, 78.47.163.141, 101.198.193.29, 149.248.217.117, 185.199.109.133, 139.99.222.72, 16.170.150.221, 137.74.223.234, 101.6.6.6, 45.67.219.208, 103.87.68.23, 89.233.43.71, 103.14.26.190, 137.66.6.146, 45.11.45.11, 216.238.80.219, 164.68.121.162, 149.112.112.9, 9.9.9.10, 198.7.58.227, 104.238.153.46, 8.8.8.8, 118.27.108.140, 167.235.236.107, 223.5.5.5, 172.104.206.174, 68.183.253.200, 112.213.32.219, 5.2.75.75, 167.235.236.107, 213.196.191.96, 1.0.0.3, 37.120.235.187, 185.32.189.62, 213.202.216.12, 1.1.1.2, 71.19.251.34, 149.112.112.12, 172.67.134.157, 178.175.129.16, 94.140.15.15, 133.130.98.250, 185.150.99.255, 185.66.143.178, 149.28.101.119, 5.1.66.255, 195.12.48.171, 94.140.14.14, 174.138.29.175, 1.0.0.2, 104.255.175.2, 116.202.176.26, 9.9.9.12, 91.205.230.224, 104.16.132.229, 94.140.14.141, 178.216.201.128, 177.54.145.131, 37.120.142.115, 1.1.1.1, 37.120.152.235, 217.138.220.243, 172.104.93.80, 89.233.43.71, 162.250.2.3, 185.95.218.42, 76.76.2.11, 185.117.118.20, 185.22.154.19, 185.228.168.168, 163.47.117.176, 8.20.247.2, 199.180.130.39, 209.58.147.36, 94.130.135.203, 135.181.193.222, 104.21.30.162, 185.95.218.42, 45.90.30.0, 185.183.106.83, 46.227.200.54, 74.82.42.42, 37.120.147.2, 185.194.94.71, 185.95.218.43, 172.104.93.80, 9.9.9.10, 136.244.97.114, 40.76.112.230, 91.239.100.100, 174.138.21.128, 95.215.19.53, 9.9.9.9, 208.67.220.123, 103.87.68.23, 1.0.0.1, 165.231.253.163, 23.137.249.116, 165.232.32.95, 172.67.134.157, 155.254.21.250, 149.112.112.10, 185.134.196.54, 9.9.9.12, 101.198.192.33, 162.14.21.178, 37.120.234.251, 130.59.31.248, 104.21.6.78, 94.130.135.203, 103.2.57.6, 185.194.94.71, 193.37.255.227, 37.120.217.75, 128.127.104.108, 213.196.191.96, 1.0.0.2, 116.202.176.26, 133.130.118.103, 223.5.5.5, 51.15.122.250, 185.107.80.84, 172.107.199.19, 136.244.97.114, 176.9.93.198, 212.47.228.136, 149.28.101.119, 193.191.187.107, 163.172.180.125, 9.9.9.11, 45.90.30.0, 9.9.9.11, 45.153.187.96, 146.112.41.2, 149.112.112.11, 185.150.99.255, 91.219.215.227, 89.58.6.169, 45.77.162.235, 176.9.93.198, 91.239.100.100, 104.16.133.229, 94.140.14.140, 1.0.0.3, 167.114.220.125, 94.198.41.235, 203.29.241.76, 149.112.112.10, 146.70.31.43, 185.134.196.55, 85.114.138.119, 45.90.28.0, 149.56.228.45, 74.82.42.42, 174.138.29.175, 37.120.207.131, 112.213.32.219, 46.102.157.110, 162.14.21.56, 95.215.19.53, 193.70.85.11, 217.146.14.3, 78.46.244.143, 146.255.56.98, 94.140.15.15, 146.112.41.4, 217.138.219.219, 103.2.57.5, 103.87.68.24, 103.2.57.5, 52.65.235.129, 163.172.34.56, 103.236.162.119, 143.244.33.74, 185.228.168.9, 45.67.219.208, 70.36.170.126, 94.140.14.15, 193.70.85.11, 8.8.4.4, 8.8.8.8, 194.242.2.3, 188.244.117.114, 78.129.140.65, 185.228.168.168, 149.56.228.45, 104.21.65.60, 130.59.31.251, 52.246.182.50, 146.70.66.227, 207.246.87.96, 78.47.212.211, 89.38.131.38, 5.1.66.255, 1.0.0.1, 5.2.75.75, 172.104.206.174, 37.252.231.163, 194.242.2.2, 78.47.163.141, 13.89.120.251, 167.114.220.125, 101.101.101.101, 163.47.117.176, 37.120.236.11, 104.155.237.225, 212.126.59.63, 176.9.1.117, 216.238.80.219, 149.112.112.11, 45.153.187.96, 149.112.112.112, 185.222.222.222, 104.21.6.78, 37.59.238.213, 94.140.14.14, 94.140.14.140, 89.38.131.38, 149.112.112.9, 94.140.15.16, 103.16.131.77, 94.140.14.15, 173.234.56.115, 172.67.171.30, 9.9.9.9, 185.228.168.10, 64.120.5.251, 78.47.64.161, 77.88.8.78, 35.227.226.142, 104.238.186.192, 223.6.6.6, 185.95.218.43, 104.21.55.112, 86.106.74.219, 149.112.112.12, 185.228.168.10, 94.140.15.16, 1.1.1.3, 68.183.253.200, 208.67.220.220, 146.112.41.2, 203.29.241.76, 76.76.2.11, 37.120.211.91, 103.87.68.24 }
  }
  set dnscrypt_sources_ipv6 {
    type ipv6_addr
    elements = { 2606:4700:4700::1111, 2400:6180:0:d0::5f6e:4001, 2606:4700:4700::1003, 2606:4700:3030::ac43:ad3b, 2a00:11c0:2c:4::3, 2400:c401::5054:ff:fe1b:b036, 2606:4700:4700::1002, 2620:fe::fe, 2a10:50c0::1:ff, 2001:67c:28a4::, 2404:9400:3:0:216:3eff:fee0:7f69, 2400:6180:0:d0::5f73:4001, 2a07:a8c0::, 2a01:4f8:1c0c:832d::, 2001:300::6, 2001:19f0:5001:cbb:5400:3ff:fe07:f70d, 2001:4860:4860::8844, 2606:4700:4700::1113, 2a01:9e00::55, 2400:c401::5054:ff:fe1b:b036, 2001:4860:4860::8888, 2620:fe::12, 2a04:bdc7:100:70::70, 2001:19f0:7402:1574:5400:2ff:fe66:2cff, 2a00:5980:94::71, 2a05:fc84::42, 2001:470:26:7c:b26e:bfff:fe1d:e19b, 2a02:1b8:10:234::2, 2001:19f0:5:3bd7:5400:4ff:fe05:da83, 2a03:b0c0:1:e0::487:1001, 2a07:a8c0::, 2001:df1:7340:c::beba:51d, 2001:620:0:ff::2, 2620:fe::9, 2400:8902::f03c:91ff:feda:c514, 2a01:4f8:1c17:4df8::1, 2a01:4f8:151:34aa::198, 2a00:c560:1eda::4, 2001:bc8:628:a0f::1, 2a04:52c0:101:75::75, 2a05:fc84::43, 2a10:50c0::bad1:ff, 2001:300::5, 2400:3200:baba::1, 2607:5300:61:95f:7283:11d9:f86:e690, 2607:5300:61:95f:7283:11d9:f86:e690, 2606:4700:3036::ac43:869d, 2a01:4f8:13b:3407::face, 2a07:a8c1::, 2a01:3a0:53:53::, 2404:9400:1:0:216:3eff:fef0:180a, 2001:de4::102, 2001:620:0:ff::3, 2001:41d0:302:2200::180, 2a06:1287:1605:5353::beba:51d, 2001:678:e68:f000::, 2001:678:e68:f000::, 2001:19f0:b400:1d8c:5400:4ff:fe11:b15a, 2a01:4f8:141:316d::117, 2606:4700:4700::1003, 2620:fe::11, 2a05:d016:af8:4000:7710:6fc:bde3:fe0e, 2001:19f0:b400:1d8c:5400:4ff:fe11:b15a, 2001:de4::101, 2001:470:20::2, 2001:19f0:5:3bd7:5400:4ff:fe05:da83, 2a01:9e00::54, 2a0c:b9c0:f:451d::1, 2001:67c:28a4::, 2404:9400:214e:ea00::1, 2a01:4f8:13a:250b::30, 2620:fe::fe:10, 2620:fe::fe:11, 2620:fe::fe, 2a10:50c0::bad2:ff, 2606:4700:4700::1001, 2606:1a40::11, 2a09:cd42:f:425b::1, 2a0c:b9c0:f:451d::1, 2a10:50c0::2:ff, 2620:119:fc::2, 2620:fe::9, 2a10:50c0::ad1:ff, 2606:4700:4700::1001, 2620:fe::10, 2606:4700:3037::6815:64e, 2606:4700:3035::6815:1ea2, 2620:fe::10, 2400:3200::1, 2620:fe::fe:12, 2a01:4f8:13b:3407::face, 2620:fe::fe:9, 2a09:8280:1::1:da1b, 2400:6180:0:d0::5f73:4001, 2606:4700:4700::1111, 2606:4700:4700::1002, 2a01:4f8:1c0c:8274::1, 2620:fe::fe:10, 2400:8902::f03c:91ff:feda:c514, 2606:4700:3037::6815:64e, 2620:fe::12, 2606:4700:4700::1112, 2a05:d016:af8:4000:7710:6fc:bde3:fe0e, 2001:19f0:9002:1e1c:5400:2ff:fec8:6f7f, 2001:bc8:1830:b07::1, 2a07:e340::3, 2001:67c:2354:2::53, 2a00:5980:94::71, 2620:fe::fe:11, 2a10:50c0::ad2:ff, 2606:4700:4700::1113, 2a05:fc84::43, 2606:4700:3030::ac43:ad3b, 2404:9400:214e:ea00::1, 2620:119:35::35, 2620:119:fc::2, 2606:4700::6810:85e5, 2a09:cd42:f:425b::1, 2001:19f0:5001:cbb:5400:3ff:fe07:f70d, 2a01:3a0:53:53::, 2800:1e0:1070:2::5, 2606:4700::6810:84e5, 2a05:fc84::42, 2a10:50c0::ad1:ff, 2404:9400:41a9:4800::1, 2a01:4f8:c17:ec67::1, 2a07:e340::2, 2607:5300:61:95f:7283:11d9:f86:e689, 2803:ad80:0:350::5, 2a10:50c0::bad1:ff, 2606:4700:3034::6815:413c, 2a10:50c0::1:ff, 2620:0:ccc::2, 2620:fe::11, 2a00:11c0:31:1::3, 2001:19f0:9002:de4:5400:4ff:fe08:7de3, 2607:5300:61:95f:7283:11d9:f86:e689, 2404:9400:41a9:4800::1, 2620:fe::fe:9, 2606:4700:4700::1112, 2001:41d0:302:2200::180, 2606:4700:3036::ac43:869d, 2001:19f0:9002:de4:5400:4ff:fe08:7de3, 2001:678:ed0:f000::, 2001:4860:4860::8888, 2001:678:ed0:f000::, 2620:fe::fe:12 }
  }
  chain dnscrypt_filter {
    ip daddr @dnscrypt_sources_ipv4 tcp dport @dnscrypt_ports counter accept
    ip6 daddr @dnscrypt_sources_ipv6 tcp dport @dnscrypt_ports counter accept
    ip daddr @dnscrypt_sources_ipv4 udp dport @dnscrypt_ports counter accept
    ip6 daddr @dnscrypt_sources_ipv6 udp dport @dnscrypt_ports counter accept
    ip daddr 1.1.1.1 udp dport 53 counter accept comment "Bootstrap resolver"
  }
  chain forward_hook {
    ip saddr $dnscrypt_v4_clients counter jump dnscrypt_filter
  }
}
table inet nat {
  set nat_nets {
    type ipv4_addr
    flags interval
    elements = { 10.53.53.2 }
  }
}
